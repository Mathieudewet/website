#!/usr/bin/env node

const fs = require('fs');
const { markdown } = require('markdown');
const path = require('path');
const xpath = require('xpath');
const yaml = require('js-yaml');
const { DOMParser } = require('xmldom');


var exports = module.exports = {};

exports.generateHtmlFromMdFileNode = function (filepath, id, node, onlyFirst = false) {

  let content = fs.readFileSync(path.resolve(__dirname, `../src/pages/docs/${filepath}/${id}.md`)).toString();
  content = content.replace(/([^`])(`)([^`])/gm, '$1$3');
  content = content.replace(/```(|yaml|xml|php|json|javascript|sh)[^`]*```/gm, '');
  content = markdown.toHTML(content);

  const html = new DOMParser().parseFromString(content);

  return xpath.select(onlyFirst ? `${node}[1]` : `${node}|${node}/following-sibling::*[self or self::h1 or self::h2 or self::h3 or self::h4 or self::h5 or self::h6]`, html);
};
